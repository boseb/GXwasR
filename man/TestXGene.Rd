% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/GXwasR_main_functions.R
\name{TestXGene}
\alias{TestXGene}
\title{TestXGene: Performing gene-based association test using GWAS/XWAS summary statistics.}
\usage{
TestXGene(
  DataDir,
  ResultDir = tempdir(),
  finput,
  sumstat,
  gene_file,
  gene_range = 5e+05,
  score_file,
  ref_data = NULL,
  max_gene = NULL,
  sample_size = NULL,
  genebasedTest = c("SKAT", "SKATO", "sumchi", "ACAT", "BT", "PCA", "FLM", "simpleM",
    "minp"),
  gene_approximation = TRUE,
  beta_par,
  weights_function,
  geno_variance_weights,
  kernel_p_method = "kuonen",
  acc_devies = 1e-08,
  lim_devies = 1e+06,
  rho = TRUE,
  skato_p_threshold = 0.8,
  anno_type = "",
  mac_threshold,
  reference_matrix_used,
  regularize_fun,
  pca_var_fraction = 0.85,
  flm_basis_function = "fourier",
  flm_num_basis = 25,
  flm_poly_order = 4,
  flip_genotypes = FALSE,
  omit_linear_variant = FALSE
)
}
\arguments{
\item{DataDir}{A character string for the file path of the all the input files.}

\item{ResultDir}{A character string for the file path where all output files will be stored. The default is \code{tempdir()}.}

\item{finput}{Character string, specifying the prefix of the input PLINK binary files for the genotype data. This file is used to compute the
correlation between the SNPs. This file needs to be in DataDir. If the base genotype data is unavailable, then users can use the
1000 Genomes Project samples. Users should use the population that most closely represents the base sample. For ACAT model, this
parameter is not mandatory and could be set \code{NULL}.}

\item{sumstat}{A dataframe object with GWAS summary statistics. When the base-genotype data is used to compute genetic correlations, the mandatory
columns are:
\itemize{
\item Column 1: \code{CHROM} (i.e., chromosome code),
\item Column 2: \code{POS} (i.e., base-pair position),
\item Column 3: \code{ID} (i.e. SNP IDs),
\item Column 4: \code{P} (i.e., p-values),
\item Column 5: \code{BETA} (i.e., effect-size),
\item Column 6: \code{A1} (i.e., effect allele),
\item Column 7: \code{A2} (i.e., alternative allele) and
\item Column 8: \code{EAF} (i.e., the effect allele frequency)
}

These are mandatory when base-genotype data is used to compute genetic correlations. Otherwise, if the users are using reference data,
then columns 5 to 8 are optional. Also, in that case, columns, such as \code{REF} (i.e., reference allele), and \code{ALT} (i.e., alternative allele)
could be present to compare alleles with those in the reference file and exclude genetic variants if alleles do not match. There could be an
additional column, \code{ANNO} with functional annotations (like "intron_variant", "synonymous", "missense" etc.)}

\item{gene_file}{Character string, specifying the prefix of the name of a .txt file listing genes in refFlat format. This file needs to be in \code{DataDir}. The
X-linked gene files, "Xlinkedgenes_hg19.txt" and "Xlinkedgenes_hg38.txt" and autosomal gene files, “Autosomes_hg19.txt” and “Autosomes_hg38.txt”
can be specified. The default is "Xlinkedgenes_hg19.txt". The genome built should be in agreement with the analysis.}

\item{gene_range}{Integer value, specifying the up stream and down stream range (in kilo base) of a gene for SNPs to be considered. The default is 500000.}

\item{score_file}{Character string, specifying the prefix of a file which will be used to produce score files with Z scores from P values and beta input
from GWAS summary statistics.}

\item{ref_data}{Character string, specifying the path to a reference dataframe with additional data needed to recode user data according to correlation matrices
that will be used. It contains \code{ID} column with names of  SNPs,  \code{REF} and \code{ALT} columns with alleles that were coded as 0 and 1, respectively.
Effect sizes from data will be inverted for variants with effect alleles different from \code{ALT} alleles in reference data. If presented, \code{REF} and
\code{ALT} columns from the input data will be used to sort out variants with alleles different from those in reference data. This dataframe  can also
be a source of map data and allele frequencies if they are not present in data. \code{AF} column in the reference file represents the allele frequency
of \code{ALT} allele. The default is "ref1KG.MAC5.EUR_AF.RData".}

\item{max_gene}{Positive integer value, specifying the number of genes for which the gene-based test will be performed. The default is NULL to consider
all the genes.}

\item{sample_size}{Positive integer value, specifying the sample size of the GWAS. Only needed for FLM and PCA models.}

\item{genebasedTest}{Character string, specifying the name of the gene-based test. Nine different tests can be specified, "SKAT","SKATO","sumchi","ACAT","BT","PCA",
"FLM","simpleM","minp". The default is "SKAT".}

\item{gene_approximation}{Boolean value, \code{TRUE} or \code{FALSE}, specifying whether approximation for large genes (>= 500 SNPs) should be used. Applicable for SKAT,
SKATO, sumchi, PCA, FLM. The default is \code{TRUE} for these methods).}

\item{beta_par}{Boolean value, \code{TRUE} or \code{FALSE}, specifying whether approximation for large genes (>= 500 SNPs) should be used. Applicable for SKAT, SKATO,
sumchi, PCA, FLM (default = \code{TRUE} for these methods).}

\item{weights_function}{A function of MAF to assign weights for each genetic variant. By default is \code{NULL}. In this case the weights will be calculated using
the beta distribution.}

\item{geno_variance_weights}{Character string, indicating whether scores should be weighted by the variance of genotypes: "none" (i.e., no weights applied, resulting
in a sum chi-square test); "se.beta" (i.e., scores weighted by variance of genotypes estimated from P values and effect sizes); "af"
(i.e., scores weighted by variance of genotypes calculated as \eqn{AF * (1 - AF)}, where AF is allele frequency.}

\item{kernel_p_method}{Character string, specifying the method for computing P value in kernel-based tests, such as SKAT, SKATO and sumchi. Available methods
are "kuonen" \insertCite{Belonogova2022}{GXwasR} "davies" \insertCite{Belonogova2022}{GXwasR} and "hybrid" \insertCite{Belonogova2022}{GXwasR}.
The default is "kuonen".}

\item{acc_devies}{Positive numeric value, specifying the accuracy parameter for "davies" method. The default is 1e-8.}

\item{lim_devies}{Positive numeric value, specifying the limit parameter for "davies" method. The default is 1e+6.}

\item{rho}{Logical value, 'TRUE' or 'FALSE' or can be a vector of grid values from 0 to 1. If TRUE, the optimal test (SKAT-O) is performed (12).
The default grid is c(0, 0.1^2, 0.2^2, 0.3^2, 0.4^2, 0.5^2, 0.5, 1).}

\item{skato_p_threshold}{Positive numeric value, specifying the largest P value that will be considered as important when performing computational optimization in
SKAT-O. All P values larger than skato_p_threshold will be processed via burden test. The default is 0.8}

\item{anno_type}{A character (or character vector) indicating annotation types to be used. The default is "" (i.e, nothing).}

\item{mac_threshold}{Integer value, specifying the threshold of MACs (Minor allele content) calculated from MAFs. In ACAT, scores with MAC <= 10 will be
combined using Burden test.}

\item{reference_matrix_used}{Boolean value, \code{TRUE} or \code{FALSE} logical indicating whether the correlation matrices were generated using the reference matrix. The
default is \code{FALSE}. If  \code{TRUE}, regularization algorithms will be applied to ensure the invertibility and numerical stability of
the matrices.}

\item{regularize_fun}{Character string, specifying the one of two regularization algorithms if ‘reference_matrix’ is TRUE:  'LH' (default) or 'derivLH'.
Currently, both give similar results.}

\item{pca_var_fraction}{P
ositive numeric value, specifying the minimal proportion of genetic variance within the region that should be explained by principal
components used in PCA method. This is also valid in 'simpleM'. The default is 0.85.}

\item{flm_basis_function}{Character string, specifying the name of a basis function type for beta-smooth in FLM method. Can be set to "bspline" (B-spline basis)
or "fourier" (Fourier basis, default).}

\item{flm_num_basis}{Positive integer value, specifying the number of basis functions to be used for beta-smooth in FLM method. The default is 25.}

\item{flm_poly_order}{Positive integer value, specifying the polynomial order to be used in "bspline" for FLM model. The default = 4, which corresponds to
the cubic B-splines. This has no effect if only Fourier bases are used}

\item{flip_genotypes}{L
ogical value, \code{TRUE} or \code{FALSE}, indicating whether the genotypes of some genetic variants should be flipped (relabelled) for their
better functional representation (13). The default is \code{FALSE}.}

\item{omit_linear_variant}{Logical value, \code{TRUE} or \code{FALSE}, indicating whether to omit linearly dependent genetic variants. It was done in the FLM test (4).
The default is \code{FALSE}.}
}
\value{
A data frame with columns:
\itemize{
\item gene
\item chrom
\item start
\item end
\item markers (i.e., numbers of SNPs),
\item filtered.markers (i.e. filtered SNPs)
\item pvalue (i.e., p-value).
}

Additionally, for  “BT”, there will be “beta” (i.e., gene-level estimates of betas) and “beta.se” (i.e., standard errors of betas).
For “FLM”, there will be the “model” column with the names of the functional models used for each region. Names shortly describe the
functional basis and the number of basis functions used. E.g., "F25" means 25 Fourier basis functions, "B15" means 15 B-spline basis
functions. For “PCA”, there will be the “ncomponents” (the number of the principal components used for each region) and
“explained.variance.fraction” (i.e., the proportion of genetic variance they make up) columns.
}
\description{
This function performs gene-based association tests using GWAS/XWAS summary statistics and SNP-SNP correlation
matrices. For  SNP-SNP correlation matrices, users have the flexibility to use either the base genotype data or 1000 Genomes
Phase 3 reference genotype data. Users also have options to define the regional positions of genes to include the SNPs according
to their investigation.

This function computes gene-wise SNP-SNP correlation matrices and can perform nine different gene-based tests, such as, “BT" (burden test),
"SKAT" (sequence kernel association test), "SKATO" (combination of BT and SKAT), "sumchi" (sum of χ2-statistics), "ACAT" (aggregated
Cauchy association test for combining P values), "PCA"(principal component approach), "FLM"( functional multiple linear regression model),
"simpleM" (Bonferroni correction test), "minp" (minimum P-value) leveraging PLINK1.9 \insertCite{Purcell2007}{GXwasR} and sumFREGAT
\insertCite{Svishcheva2019,Belonogova2022}{GXwasR} tools.

Though this function implicitly performs X-linked gene-based test, it is flexible to perform this analysis genome-wide.
For the details about the different tests, please follow the associated paper.
}
\examples{
data("XWAS_Summary_Example", package = "GXwasR")
DataDir <- system.file("extdata", package = "GXwasR")
ResultDir <- tempdir()
finput <- "GXwasR_example"
sumstat <- XWAS_Summary_Example
ref_data <- NULL
gene_file <- "Xlinkedgenes_hg19.txt"
gene_range <- 500000
max_gene <- 10
gene_approximation <- TRUE
beta_par <- c(1, 25)
weights_function <- NULL
geno_variance_weights <- "se.beta"
method <- "kuonen"
acc_devies <- 1e-8
lim_devies <- 1e+6
rho <- TRUE
skato_p_threshold <- 0.8
mac_threshold <- 3
sample_size <- 4000
reference_matrix_used <- FALSE
regularize_fun <- "LH"
pca_var_fraction <- 0.85
flm_basis_function <- "fourier"
flm_num_basis <- 25
flm_poly_order <- 4
flip_genotypes <- FALSE
omit_linear_variant <- FALSE
kernel_p_method <- "kuonen"
anno_type <- ""
GenetestResult <- TestXGene(DataDir, ResultDir, finput, sumstat, gene_file,
    gene_range, score_file, ref_data, max_gene, sample_size,
    genebasedTest = "SKAT",
    gene_approximation, beta_par, weights_function, geno_variance_weights,
    kernel_p_method, acc_devies, lim_devies, rho, skato_p_threshold, anno_type,
    mac_threshold, reference_matrix_used, regularize_fun, pca_var_fraction,
    flm_basis_function, flm_num_basis, flm_poly_order, flip_genotypes,
    omit_linear_variant
)
}
\references{
\insertAllCited{}
}
\author{
Banabithi Bose
}
